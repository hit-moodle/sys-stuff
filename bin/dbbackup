#!/bin/bash

#--------Configure the Database First--------------------

CONFIG=`dirname $0`/../etc/config
test -r $CONFIG || exit
. $CONFIG

#-----------------------------------------------------

NewFile="$BACKUP_PATH/db_$DBName"_$(date +%Y%m%d).tgz
DumpFile="$BACKUP_PATH/db_$DBName"_$(date +%Y%m%d).sql
echo "-------------------------------------------"
echo $(date +"%y-%m-%d %H:%M:%S")
echo "-------------------------------------------"

if [ -f $NewFile ]
then
    echo "[$NewFile]The backup file exists, can't backup!"
else
    [ -n $DBPasswd ] && pass=-p$DBPasswd
    mysqldump -u $DBUser $pass -h $DBHost --single-transaction --opt --skip-lock-tables $DBName > $DumpFile
    tar czvf $NewFile $DumpFile
    md5sum $NewFile > $NewFile.md5
    echo "[$NewFile]Backup Success!"
    rm -rf $DumpFile
fi
echo "-------------------------------------------"

