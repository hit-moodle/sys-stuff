#!/bin/sh

CONFIG=`dirname $0`/../etc/config
test -r $CONFIG || exit
. $CONFIG

CUR_DATE=`date +20%y%m%d `  #FIXME:20xx year

DES_DIR=$BACKUP_PATH
SRC_DIRS=$BACKUP_FROM
LOG_FILE=/var/log/backup.log
flags=d:s:l:?

while getopts $flags name
do
	case $name in
	d)	DES_DIR="$OPTARG";;
	s)	SRC_DIRS="$OPTARG";;
	l)	LOG_FILE="$OPTARG";;
	esac
done

for SRC_DIR in $SRC_DIRS; do
    DES_FILE=`echo ${SRC_DIR##*/}` 
    DES_FILE=`printf "%s%s_%s%s" "$DES_DIR/" "$DES_FILE" "$CUR_DATE" ".tar.gz"`
    tar -zcf $DES_FILE $SRC_DIR
    md5sum $DES_FILE > $DES_FILE.md5

    echo "$CUR_DATE: $DES_FILE from $SRC_DIR" >> $LOG_FILE
done

exit 0

